pipeline {
    agent any

    tools {
        jdk 'JDK25'          // Must match Global Tool name exactly
        maven 'Maven3'       // Must match Global Tool name exactly
    }

    triggers {
            cron('H/5 * * * *')         // 🔁 Run every 5 minutes (safe hashed version)
        }


    stages {
        stage('Checkout') {
            steps {
                echo '📥 Checking out code...'
                git branch: 'main', url: 'https://github.com/jehkundan/saucedemo-automation-framework.git'
            }
        }

        stage('Build & tests') {
            steps {
                echo '🧪 Running Maven tests...'
                sh 'mvn clean test'
            }
        }

        stage('Allure Report') {
            steps {
                echo '📊 Generating Allure report...'
                allure includeProperties: false, results: [[path: 'allure-results']]
            }
        }
    }

    post {
        success { echo '✅ Build succeeded' }
        failure { echo '❌ Build failed — check console & Allure' }
        always  { echo '📌 Pipeline finished' }
    }
}

